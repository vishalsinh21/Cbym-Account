<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CBYM Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="dashboard-container">

    <!-- Header with Logout & Change Password -->
    <div class="dashboard-header">
        <h1>CBYM Dashboard</h1>
        <div class="header-buttons">
            <a href="{{ url_for('change_password') }}"><button>Change Password</button></a>
            <a href="{{ url_for('logout') }}"><button>Logout</button></a>
        </div>
    </div>

    <!-- Summary -->
    <div class="summary">
        <p>Total Donations: ${{ total_donations }}</p>
        <p>Total Expenses: ${{ total_expenses }}</p>
        <p>Available Balance: ${{ available_balance }}</p>
    </div>

    <!-- Add/Edit/Delete Contributors -->
    <h2>Add / Edit Contributors</h2>
    <form method="POST">
        <input type="hidden" name="id" id="cid">
        <input type="text" name="name" id="name" placeholder="Name" required>
        <input type="email" name="email" id="email" placeholder="Email" required>
        <input type="number" name="amount" id="amount" placeholder="Amount" required>
        <select name="payment" id="payment">
            <option value="Cash">Cash</option>
            <option value="GPay">GPay</option>
            <option value="Online">Online</option>
        </select>
        <button type="submit" name="add">Add</button>
        <button type="submit" name="edit">Edit</button>
        <button type="submit" name="delete">Delete</button>
    </form>

    <!-- Contributors Table -->
    <h2>Contributors List</h2>
    <table>
        <tr><th>ID</th><th>Name</th><th>Email</th><th>Amount</th><th>Payment</th></tr>
        {% for c in contributors %}
        <tr onclick="fillContributor('{{ c[0] }}','{{ c[1] }}','{{ c[2] }}','{{ c[3] }}','{{ c[4] }}')">
            <td>{{ c[0] }}</td><td>{{ c[1] }}</td><td>{{ c[2] }}</td><td>{{ c[3] }}</td><td>{{ c[4] }}</td>
        </tr>
        {% endfor %}
    </table>

    <!-- Add Expense -->
    <h2>Add Expense</h2>
    <form method="POST">
        <input type="text" name="title" placeholder="Expense Title" required>
        <input type="number" name="expense_amount" placeholder="Amount" required>
        <button type="submit" name="add_expense">Add Expense</button>
    </form>

    <!-- Expenses Table with Delete -->
    <h2>Expenses List</h2>
    <table>
        <tr><th>ID</th><th>Title</th><th>Amount</th><th>Action</th></tr>
        {% for e in expenses %}
        <tr>
            <td>{{ e[0] }}</td>
            <td>{{ e[1] }}</td>
            <td>{{ e[2] }}</td>
            <td>
                <form method="POST" style="display:inline;">
                    <input type="hidden" name="expense_id" value="{{ e[0] }}">
                    <button type="submit" name="delete_expense" onclick="return confirm('Are you sure you want to delete this expense?')">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
function fillContributor(id,name,email,amount,payment){
    document.getElementById('cid').value = id;
    document.getElementById('name').value = name;
    document.getElementById('email').value = email;
    document.getElementById('amount').value = amount;
    document.getElementById('payment').value = payment;
}
</script>

</body>
</html>
